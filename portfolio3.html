<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office & Warehouse Locations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        .map-section {
            padding: 40px 20px;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        #map {
            width: 100%;
            height: 450px;
            border-radius: 14px;
            border: 1px solid rgba(14, 4, 4, 0.1);
        }

        .custom-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            border: 3px solid #ffffff;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: #164476;
        }

        .custom-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 0 40px rgba(22, 68, 118, 0.8);
        }

        .custom-marker.hq {
            width: 60px;
            height: 60px;
            font-size: 28px;
            border-color: #dc2626;
            background: #dc2626;
            animation: pulseMain 2s ease-in-out infinite;
        }

        @keyframes pulseMain {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.12);
            }
        }

        .custom-marker.unit {
            width: 50px;
            height: 50px;
            font-size: 24px;
            border-color: #2563eb;
            background: #2563eb;
        }

        .custom-marker.unit:hover {
            border-color: #1d4ed8;
        }

        .custom-marker.godown {
            width: 40px;
            height: 40px;
            font-size: 18px;
            border-color: #059669;
            background: #059669;
        }

        .custom-marker.godown:hover {
            border-color: #047857;
        }

        .popup-content {
            font-family: Arial, sans-serif;
        }

        .popup-title {
            font-weight: 700;
            font-size: 14px;
            color: #164476;
            margin-bottom: 6px;
        }

        .popup-detail {
            font-size: 12px;
            color: #666;
            margin: 4px 0;
        }

        .leaflet-control-attribution {
            background: rgba(255, 255, 255, 0.8) !important;
            color: #666 !important;
            border-radius: 8px;
            font-size: 9px;
            backdrop-filter: blur(10px);
        }

        .leaflet-control-zoom {
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .leaflet-control-zoom a {
            background: rgba(22, 68, 118, 0.1) !important;
            color: #164476 !important;
            border: none !important;
            border-bottom: 1px solid rgba(22, 68, 118, 0.1) !important;
            transition: all 0.3s ease !important;
            font-weight: 700;
            font-size: 14px;
        }

        .leaflet-control-zoom a:hover {
            background: rgba(22, 68, 118, 0.2) !important;
            color: #0d3659 !important;
        }

        /* Tablet */
        @media (max-width: 1024px) {
            .map-section {
                padding: 35px 18px;
            }

            #map {
                height: 400px;
                border-radius: 12px;
            }

            .custom-marker.hq {
                width: 55px;
                height: 55px;
                font-size: 26px;
            }

            .custom-marker.unit {
                width: 46px;
                height: 46px;
                font-size: 22px;
            }

            .custom-marker.godown {
                width: 38px;
                height: 38px;
                font-size: 17px;
            }
        }

        /* Mobile Large */
        @media (max-width: 768px) {
            .map-section {
                padding: 30px 15px;
            }

            #map {
                height: 350px;
                border-radius: 10px;
            }

            .custom-marker.hq {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .custom-marker.unit {
                width: 42px;
                height: 42px;
                font-size: 20px;
            }

            .custom-marker.godown {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .popup-title {
                font-size: 13px;
            }

            .popup-detail {
                font-size: 11px;
            }
        }

        /* Mobile Medium */
        @media (max-width: 576px) {
            .map-section {
                padding: 25px 12px;
            }

            #map {
                height: 320px;
                border-radius: 8px;
            }

            .custom-marker.hq {
                width: 45px;
                height: 45px;
                font-size: 22px;
            }

            .custom-marker.unit {
                width: 38px;
                height: 38px;
                font-size: 18px;
            }

            .custom-marker.godown {
                width: 34px;
                height: 34px;
                font-size: 15px;
            }
        }

        /* Mobile Small */
        @media (max-width: 480px) {
            .map-section {
                padding: 20px 10px;
            }

            #map {
                height: 300px;
                border-radius: 8px;
            }

            .custom-marker.hq {
                width: 42px;
                height: 42px;
                font-size: 20px;
                border-width: 2px;
            }

            .custom-marker.unit {
                width: 36px;
                height: 36px;
                font-size: 18px;
                border-width: 2px;
            }

            .custom-marker.godown {
                width: 32px;
                height: 32px;
                font-size: 14px;
                border-width: 2px;
            }

            .popup-title {
                font-size: 12px;
            }

            .popup-detail {
                font-size: 10px;
            }

            .leaflet-control-zoom a {
                font-size: 12px;
            }
        }

        /* Mobile Extra Small */
        @media (max-width: 375px) {
            .map-section {
                padding: 15px 8px;
            }

            #map {
                height: 280px;
            }

            .custom-marker.hq {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .custom-marker.unit {
                width: 34px;
                height: 34px;
                font-size: 16px;
            }

            .custom-marker.godown {
                width: 30px;
                height: 30px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <section class="map-section">
        <div id="map"></div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Note: Please update Head Office and Unit 1 coordinates from your Google Maps links
        // The coordinates below are placeholders based on typical Kerala locations
        const locations = [
            {
                name: 'Head Office',
                type: 'Headquarters',
                lat: 10.5276,  // UPDATE with actual coordinates from your Google Maps link
                lng: 76.2144,  // UPDATE with actual coordinates from your Google Maps link
                address: 'Update with Head Office address',  // UPDATE this
                icon: 'ðŸ¢',
                category: 'hq'
            },
            {
                name: 'Unit 1',
                type: 'Production Unit',
                lat: 10.5500,  // UPDATE with actual coordinates from your Google Maps link
                lng: 76.4500,  // UPDATE with actual coordinates from your Google Maps link
                address: 'Update with Unit 1 address',  // UPDATE this
                icon: 'ðŸ­',
                category: 'unit'
            },
            {
                name: 'Godown 1',
                type: 'Warehouse',
                lat: 10.558250,
                lng: 76.481972,
                address: 'Godown 1, Near Vellangallur, Kerala',  // UPDATE with actual address
                icon: 'ðŸ“¦',
                category: 'godown'
            },
            {
                name: 'Godown 2',
                type: 'Warehouse',
                lat: 10.545694,
                lng: 76.477611,
                address: 'Godown 2, Near Vellangallur, Kerala',  // UPDATE with actual address
                icon: 'ðŸ“¦',
                category: 'godown'
            }
        ];

        // Initialize map centered on the region
        const map = L.map('map').setView([10.55, 76.45], 12);

        // Add tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        const markers = {};
        const markerLayers = L.featureGroup().addTo(map);

        // Create markers with address fetching
        locations.forEach(async (location) => {
            const customIcon = L.divIcon({
                html: `<div class="custom-marker ${location.category}">${location.icon}</div>`,
                className: '',
                iconSize: [location.category === 'hq' ? 60 : location.category === 'unit' ? 50 : 40, 
                          location.category === 'hq' ? 60 : location.category === 'unit' ? 50 : 40],
                iconAnchor: [location.category === 'hq' ? 30 : location.category === 'unit' ? 25 : 20, 
                            location.category === 'hq' ? 60 : location.category === 'unit' ? 50 : 40]
            });

            // Fetch address from Nominatim (OpenStreetMap)
            let fetchedAddress = location.address || 'Fetching address...';
            
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${location.lat}&lon=${location.lng}&zoom=18&addressdetails=1`);
                const data = await response.json();
                
                if (data && data.display_name) {
                    fetchedAddress = data.display_name;
                }
            } catch (error) {
                console.error('Error fetching address:', error);
                fetchedAddress = location.address || `${location.lat.toFixed(6)}, ${location.lng.toFixed(6)}`;
            }

            const popupContent = `
                <div class="popup-content">
                    <div class="popup-title">${location.name}</div>
                    <div class="popup-detail"><strong>Type:</strong> ${location.type}</div>
                    <div class="popup-detail"><strong>Address:</strong> ${fetchedAddress}</div>
                </div>
            `;

            const marker = L.marker([location.lat, location.lng], {
                icon: customIcon,
                title: location.name
            })
            .bindPopup(popupContent, { maxWidth: 300 })
            .addTo(map);

            // Add click event to fly to location
            marker.on('click', function() {
                map.flyTo([location.lat, location.lng], 15, {
                    duration: 1.5,
                    easeLinearity: 0.25
                });
            });

            markers[location.name] = marker;
            markerLayers.addLayer(marker);
        });

        // Draw connection lines: Head Office â†’ Unit 1 â†’ Godowns
        const connectionLayers = L.featureGroup().addTo(map);
        
        const headOffice = locations[0];
        const unit1 = locations[1];
        const godowns = [locations[2], locations[3]];

        // Connection: Head Office â†’ Unit 1
        function drawConnection(from, to, color) {
            // Main line
            const polyline = L.polyline(
                [[from.lat, from.lng], [to.lat, to.lng]],
                {
                    color: color,
                    weight: 2.5,
                    opacity: 0.7,
                    dashArray: '6, 4',
                    lineCap: 'round',
                    lineJoin: 'round'
                }
            ).addTo(map);

            // Glow effect
            const glowLine = L.polyline(
                [[from.lat, from.lng], [to.lat, to.lng]],
                {
                    color: color,
                    weight: 8,
                    opacity: 0.12,
                    lineCap: 'round',
                    lineJoin: 'round'
                }
            ).addTo(map);

            connectionLayers.addLayer(polyline);
            connectionLayers.addLayer(glowLine);
        }

        // Head Office â†’ Unit 1 (Red line)
        drawConnection(headOffice, unit1, '#dc2626');

        // Unit 1 â†’ Godown 1 and Godown 2 (Blue lines)
        godowns.forEach((godown) => {
            drawConnection(unit1, godown, '#2563eb');
        });

        // Fit bounds
        map.fitBounds(markerLayers.getBounds().pad(0.15));

        // Responsive handling
        function handleResize() {
            map.invalidateSize();
            
            // Adjust zoom based on screen size
            const width = window.innerWidth;
            if (width < 480) {
                map.setZoom(10);
            } else if (width < 768) {
                map.setZoom(11);
            } else {
                map.fitBounds(markerLayers.getBounds().pad(0.15));
            }
        }

        window.addEventListener('resize', handleResize);
        
        // Initial resize check
        setTimeout(handleResize, 100);
    </script>
</body>
</html>